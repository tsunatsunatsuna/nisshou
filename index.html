<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日照計算シミュレーター Pro</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #059669;
            --warning: #d97706;
            --bg: #f8fafc;
        }
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif; line-height: 1.6; color: #1e293b; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { font-size: 1.5rem; color: #0f172a; text-align: center; margin-bottom: 1.5rem; }
        
        /* Form Styling */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .field { margin-bottom: 10px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; display: flex; align-items: center; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        
        /* Info Icon & Tooltip */
        .info-icon { margin-left: 5px; cursor: help; background: #94a3b8; color: white; width: 16px; height: 16px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; position: relative; }
        .info-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%);
            background: #334155; color: white; padding: 8px; border-radius: 4px; font-size: 0.75rem; white-space: pre-wrap; width: 200px; z-index: 10; font-weight: normal;
        }

        /* Buttons & Tabs */
        button.main-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; margin-top: 10px; transition: opacity 0.2s; }
        button.main-btn:hover { opacity: 0.9; }
        
        .tabs { display: flex; gap: 5px; margin-top: 20px; border-bottom: 2px solid #e2e8f0; }
        .tab-btn { padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--secondary); border-bottom: 2px solid transparent; margin-bottom: -2px; }
        .tab-btn.active { color: var(--primary); border-bottom: 2px solid var(--primary); font-weight: bold; }

        /* Results */
        .result-display { display: grid; grid-template-columns: 1fr; gap: 10px; text-align: center; margin-top: 10px; }
        .res-item { background: #eff6ff; padding: 15px; border-radius: 8px; }
        .res-val { font-size: 1.5rem; font-weight: bold; color: var(--primary); }

        /* Table */
        .table-wrapper { overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; min-width: 500px; }
        th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #e2e8f0; }
        th { background: #f1f5f9; position: sticky; top: 0; }
        .status-sun { color: var(--success); font-weight: bold; }
        .status-shadow { color: var(--secondary); }

        @media (max-width: 480px) {
            h1 { font-size: 1.2rem; }
            .card { padding: 15px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>日照シミュレーター Pro</h1>

    <div class="card">
        <div class="grid">
            <div class="field">
                <label>日付 (代表日)</label>
                <select id="dateSelect">
                    <option value="-23.44">冬至 (12/22頃)</option>
                    <option value="0">春分・秋分 (3/21, 9/23頃)</option>
                    <option value="23.44">夏至 (6/21頃)</option>
                </select>
            </div>
            <div class="field">
                <label>緯度 (東京: 35.7)</label>
                <input type="number" id="lat" value="35.7" step="0.1">
            </div>
            <div class="field">
                <label>
                    判定面の高さ
                    <span class="info-icon" data-tooltip="4m: 第1種・第2種低層住居専用地域などの一般的な基準面&#10;6.5m: 第1種中高層住居専用地域などの基準面">i</span>
                </label>
                <select id="h_obs">
                    <option value="4.0">4.0 m (低層地域)</option>
                    <option value="6.5">6.5 m (中高層地域)</option>
                    <option value="1.5">1.5 m (1階窓面目安)</option>
                </select>
            </div>
            <div class="field">
                <label>建物高さ (m)</label>
                <input type="number" id="h_build" value="10" step="0.1">
            </div>
            <div class="field">
                <label>建物までの距離 (m)</label>
                <input type="number" id="dist" value="15" step="0.1">
            </div>
        </div>
        <button class="main-btn" onclick="calculate()">シミュレーション実行</button>
    </div>

    <div id="resultsArea" style="display:none;">
        <div class="card">
            <h3>日照時間 合計 (08:00 - 16:00)</h3>
            <div class="result-display">
                <div class="res-item">
                    <div style="font-size: 0.8rem;">選択した観測点</div>
                    <div class="res-val" id="res_selected">-- 分</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="tabs">
                <button class="tab-btn active" onclick="changeInterval(60, this)">1時間</button>
                <button class="tab-btn" onclick="changeInterval(30, this)">30分</button>
                <button class="tab-btn" onclick="changeInterval(10, this)">10分</button>
            </div>
            <div class="table-wrapper">
                <table id="detailTable">
                    <thead>
                        <tr>
                            <th>時刻</th>
                            <th>太陽高度</th>
                            <th>1階(2.0m)</th>
                            <th>2階(4.0m)</th>
                            <th id="th_custom">観測点</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let currentInterval = 60;

    function changeInterval(min, btn) {
        currentInterval = min;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        calculate();
    }

    function calculate() {
        const lat = parseFloat(document.getElementById('lat').value) * Math.PI / 180;
        const hBuild = parseFloat(document.getElementById('h_build').value);
        const dist = parseFloat(document.getElementById('dist').value);
        const hObsSelected = parseFloat(document.getElementById('h_obs').value);
        const delta = parseFloat(document.getElementById('dateSelect').value) * Math.PI / 180;
        
        document.getElementById('th_custom').innerText = `指定(${hObsSelected}m)`;

        let totalSunSelected = 0;
        const tbody = document.querySelector('#detailTable tbody');
        tbody.innerHTML = '';

        // 8:00から16:00まで指定の間隔でループ
        for (let m = 8 * 60; m <= 16 * 60; m += currentInterval) {
            const hour = m / 60;
            const h_time = (hour - 12) * 15 * Math.PI / 180; // 時角
            
            // 太陽高度 (sin h)
            const sinAlt = Math.sin(lat) * Math.sin(delta) + Math.cos(lat) * Math.cos(delta) * Math.cos(h_time);
            const alt = Math.asin(sinAlt);
            const altDeg = alt * 180 / Math.PI;

            const checkSun = (hObs) => {
                if (altDeg <= 0) return false;
                const relH = hBuild - hObs;
                if (relH <= 0) return true; // 建物より高い位置なら常に日向
                const shadowLen = relH / Math.tan(alt);
                return shadowLen < dist;
            };

            const isSun1F = checkSun(2.0);
            const isSun2F = checkSun(4.0);
            const isSunSelected = checkSun(hObsSelected);

            if (isSunSelected) totalSunSelected += currentInterval;

            const timeStr = `${Math.floor(hour)}:${String(Math.round((hour % 1) * 60)).padStart(2, '0')}`;
            
            const row = `<tr>
                <td>${timeStr}</td>
                <td>${altDeg > 0 ? altDeg.toFixed(1) + '°' : '日没'}</td>
                <td class="${isSun1F ? 'status-sun' : 'status-shadow'}">${isSun1F ? '☀️' : '☁️'}</td>
                <td class="${isSun2F ? 'status-sun' : 'status-shadow'}">${isSun2F ? '☀️' : '☁️'}</td>
                <td class="${isSunSelected ? 'status-sun' : 'status-shadow'}">${isSunSelected ? '☀️' : '☁️'}</td>
            </tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
        }

        document.getElementById('res_selected').innerText = totalSunSelected + " 分";
        document.getElementById('resultsArea').style.display = 'block';
    }
</script>

</body>
</html>
